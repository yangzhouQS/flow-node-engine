# flow-node-engine 功能开发路线图

> **文档说明**: 本文档支持执行状态追踪，状态字段说明：
> - 🔴 未开始 (PENDING)
> - 🟡 进行中 (IN_PROGRESS)
> - 🟢 已完成 (COMPLETED)
> - 🔵 已阻塞 (BLOCKED)
> - ⚪ 已取消 (CANCELLED)

---

## 版本规划概览

| 版本 | 目标 | 预计周期 | 状态 | 完成度 | 主要内容 |
|------|------|----------|------|--------|----------|
| v1.1 | DMN增强 | 4周 | 🔴 未开始 | 0% | DMN XML导入导出、FEEL表达式 |
| v1.2 | 流程增强 | 4周 | 🔴 未开始 | 0% | 监听器、补偿事件、多实例 |
| v1.3 | 集成增强 | 3周 | 🔴 未开始 | 0% | 邮件服务、流程图生成 |
| v1.4 | 企业集成 | 3周 | 🔴 未开始 | 0% | LDAP集成、流程迁移 |
| v2.0 | 高级特性 | 6周 | 🔴 未开始 | 0% | 事务子流程、动态流程 |

---

## v1.1 - DMN决策引擎增强 (高优先级)

**目标**: 完善DMN标准支持，实现与Flowable DMN的功能对齐

**预计周期**: 4周

**版本状态**: 🔴 未开始

**开始日期**: _待定_

**预计完成**: _待定_

**实际完成**: _-

### 1.1 DMN XML导入导出

**状态**: 🔴 未开始

**预计时间**: 2周

**完成度**: 0%

**负责人**: _待分配_

**开始日期**: _待定_

**实际完成**: _-

#### 任务清单

| ID | 任务 | 预计时间 | 状态 | 完成度 | 负责人 | 开始日期 | 完成日期 | 备注 |
|----|------|----------|------|--------|--------|----------|----------|------|
| T1.1.1 | DMN XML Schema分析 | 2天 | 🔴 未开始 | 0% | - | - | - | 分析DMN 1.1/1.3 XSD |
| T1.1.2 | DmnXmlParser服务实现 | 3天 | 🔴 未开始 | 0% | - | - | - | 依赖T1.1.1 |
| T1.1.3 | DmnXmlExporter服务实现 | 3天 | 🔴 未开始 | 0% | - | - | - | 依赖T1.1.2 |
| T1.1.4 | DMN模型转换器 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T1.1.2, T1.1.3 |
| T1.1.5 | 单元测试 | 2天 | 🔴 未开始 | 0% | - | - | - | 覆盖率≥80% |

#### 验收标准

| 标准 | 状态 | 验证日期 | 验证人 |
|------|------|----------|--------|
| 能正确解析Flowable导出的DMN XML | ⬜ 未验证 | - | - |
| 能将决策表导出为标准DMN XML | ⬜ 未验证 | - | - |
| 支持所有8种HitPolicy的导入导出 | ⬜ 未验证 | - | - |
| 单元测试覆盖率≥80% | ⬜ 未验证 | - | - |

### 1.2 FEEL表达式完整支持

**状态**: 🔴 未开始

**预计时间**: 2周

**完成度**: 0%

**负责人**: _待分配_

**开始日期**: _待定_

**实际完成**: _-

#### 任务清单

| ID | 任务 | 预计时间 | 状态 | 完成度 | 负责人 | 开始日期 | 完成日期 | 备注 |
|----|------|----------|------|--------|--------|----------|----------|------|
| T1.2.1 | FEEL语法分析器 | 3天 | 🔴 未开始 | 0% | - | - | - | 使用ANTLR或手写解析器 |
| T1.2.2 | FEEL求值引擎 | 4天 | 🔴 未开始 | 0% | - | - | - | 依赖T1.2.1 |
| T1.2.3 | 内置函数实现 | 3天 | 🔴 未开始 | 0% | - | - | - | sum/max/min/date等 |
| T1.2.4 | 与ConditionEvaluator集成 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T1.2.2 |
| T1.2.5 | 单元测试和集成测试 | 2天 | 🔴 未开始 | 0% | - | - | - | 覆盖率≥85% |

#### FEEL表达式支持范围

| 类型 | 语法示例 | 状态 | 完成度 |
|------|----------|------|--------|
| 算术表达式 | `+`, `-`, `*`, `/`, `**` | 🔴 未开始 | 0% |
| 比较表达式 | `<`, `<=`, `>`, `>=`, `=`, `!=` | 🔴 未开始 | 0% |
| 逻辑表达式 | `and`, `or`, `not` | 🔴 未开始 | 0% |
| 区间表达式 | `[1..10]`, `(1..10)` | 🔴 未开始 | 0% |
| 列表表达式 | `[1, 2, 3]`, `1 to 10` | 🔴 未开始 | 0% |
| 函数调用 | `sum([1,2,3])` | 🔴 未开始 | 0% |
| 日期时间 | `date("2024-01-01")` | 🔴 未开始 | 0% |
| 字符串函数 | `concat`, `substring` | 🔴 未开始 | 0% |

#### 验收标准

| 标准 | 状态 | 验证日期 | 验证人 |
|------|------|----------|--------|
| 支持DMN标准FEEL语法 | ⬜ 未验证 | - | - |
| 兼容Flowable FEEL实现 | ⬜ 未验证 | - | - |
| 性能满足生产要求(1000次/秒) | ⬜ 未验证 | - | - |
| 单元测试覆盖率≥85% | ⬜ 未验证 | - | - |

---

## v1.2 - BPMN流程引擎增强 (高优先级)

**目标**: 完善BPMN核心功能，支持高级流程模式

**预计周期**: 4周

**版本状态**: 🔴 未开始

**开始日期**: _待定_

**预计完成**: _待定_

**实际完成**: _-

### 2.1 监听器完整实现

**状态**: 🔴 未开始

**预计时间**: 1.5周

**完成度**: 0%

**负责人**: _待分配_

**开始日期**: _待定_

**实际完成**: _-

#### 任务清单

| ID | 任务 | 预计时间 | 状态 | 完成度 | 负责人 | 开始日期 | 完成日期 | 备注 |
|----|------|----------|------|--------|--------|----------|----------|------|
| T2.1.1 | Execution Listener接口设计 | 1天 | 🔴 未开始 | 0% | - | - | - | START/END/TAKE事件 |
| T2.1.2 | Task Listener接口设计 | 1天 | 🔴 未开始 | 0% | - | - | - | CREATE/ASSIGNMENT/COMPLETE/DELETE |
| T2.1.3 | Listener注册和调度机制 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T2.1.1, T2.1.2 |
| T2.1.4 | 内置Listener实现 | 2天 | 🔴 未开始 | 0% | - | - | - | 日志/邮件等 |
| T2.1.5 | 与流程执行器集成 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T2.1.3 |
| T2.1.6 | 单元测试 | 2天 | 🔴 未开始 | 0% | - | - | - | 覆盖率≥80% |

#### 监听器类型支持

| 类型 | 事件 | 状态 | 完成度 |
|------|------|------|--------|
| Execution Listener | START | 🔴 未开始 | 0% |
| Execution Listener | END | 🔴 未开始 | 0% |
| Execution Listener | TAKE | 🔴 未开始 | 0% |
| Task Listener | CREATE | 🔴 未开始 | 0% |
| Task Listener | ASSIGNMENT | 🔴 未开始 | 0% |
| Task Listener | COMPLETE | 🔴 未开始 | 0% |
| Task Listener | DELETE | 🔴 未开始 | 0% |

### 2.2 补偿事件处理

**状态**: 🔴 未开始

**预计时间**: 1.5周

**完成度**: 0%

**负责人**: _待分配_

**开始日期**: _待定_

**实际完成**: _-

#### 任务清单

| ID | 任务 | 预计时间 | 状态 | 完成度 | 负责人 | 开始日期 | 完成日期 | 备注 |
|----|------|----------|------|--------|--------|----------|----------|------|
| T2.2.1 | 补偿事件模型设计 | 1天 | 🔴 未开始 | 0% | - | - | - | - |
| T2.2.2 | 补偿处理器接口 | 1天 | 🔴 未开始 | 0% | - | - | - | 依赖T2.2.1 |
| T2.2.3 | 补偿边界事件实现 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T2.2.2 |
| T2.2.4 | 补偿中间抛出事件实现 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T2.2.3 |
| T2.2.5 | 补偿作用域管理 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T2.2.4 |
| T2.2.6 | 单元测试和集成测试 | 2天 | 🔴 未开始 | 0% | - | - | - | 覆盖率≥80% |

### 2.3 多实例完整实现

**状态**: 🔴 未开始

**预计时间**: 1周

**完成度**: 0%

**负责人**: _待分配_

**开始日期**: _待定_

**实际完成**: _-

#### 任务清单

| ID | 任务 | 预计时间 | 状态 | 完成度 | 负责人 | 开始日期 | 完成日期 | 备注 |
|----|------|----------|------|--------|--------|----------|----------|------|
| T2.3.1 | 顺序多实例实现 | 2天 | 🔴 未开始 | 0% | - | - | - | - |
| T2.3.2 | 并行多实例实现 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T2.3.1 |
| T2.3.3 | 多实例变量处理 | 1天 | 🔴 未开始 | 0% | - | - | - | 依赖T2.3.2 |
| T2.3.4 | 多实例完成条件 | 1天 | 🔴 未开始 | 0% | - | - | - | 依赖T2.3.3 |
| T2.3.5 | 单元测试 | 1天 | 🔴 未开始 | 0% | - | - | - | 覆盖率≥80% |

---

## v1.3 - 集成能力增强 (中优先级)

**目标**: 增强系统集成能力，提供邮件通知和流程可视化

**预计周期**: 3周

**版本状态**: 🔴 未开始

**开始日期**: _待定_

**预计完成**: _待定_

**实际完成**: _-

### 3.1 邮件服务

**状态**: 🔴 未开始

**预计时间**: 1.5周

**完成度**: 0%

**负责人**: _待分配_

#### 任务清单

| ID | 任务 | 预计时间 | 状态 | 完成度 | 负责人 | 开始日期 | 完成日期 | 备注 |
|----|------|----------|------|--------|--------|----------|----------|------|
| T3.1.1 | 邮件模块配置 | 1天 | 🔴 未开始 | 0% | - | - | - | SMTP配置 |
| T3.1.2 | MailService实现 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T3.1.1 |
| T3.1.3 | 邮件模板引擎 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T3.1.2 |
| T3.1.4 | 邮件任务执行器 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T3.1.3 |
| T3.1.5 | 与流程引擎集成 | 1天 | 🔴 未开始 | 0% | - | - | - | 依赖T3.1.4 |
| T3.1.6 | 单元测试 | 1天 | 🔴 未开始 | 0% | - | - | - | 覆盖率≥75% |

### 3.2 流程图生成

**状态**: 🔴 未开始

**预计时间**: 1.5周

**完成度**: 0%

**负责人**: _待分配_

#### 任务清单

| ID | 任务 | 预计时间 | 状态 | 完成度 | 负责人 | 开始日期 | 完成日期 | 备注 |
|----|------|----------|------|--------|--------|----------|----------|------|
| T3.2.1 | 流程图生成器接口设计 | 1天 | 🔴 未开始 | 0% | - | - | - | - |
| T3.2.2 | BPMN元素位置计算 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T3.2.1 |
| T3.2.3 | SVG生成器实现 | 3天 | 🔴 未开始 | 0% | - | - | - | 依赖T3.2.2 |
| T3.2.4 | 高亮当前节点功能 | 1天 | 🔴 未开始 | 0% | - | - | - | 依赖T3.2.3 |
| T3.2.5 | REST API暴露 | 1天 | 🔴 未开始 | 0% | - | - | - | 依赖T3.2.4 |
| T3.2.6 | 单元测试 | 1天 | 🔴 未开始 | 0% | - | - | - | 覆盖率≥70% |

---

## v1.4 - 企业集成 (中优先级)

**目标**: 支持企业级集成需求

**预计周期**: 3周

**版本状态**: 🔴 未开始

### 4.1 LDAP集成

**状态**: 🔴 未开始

**预计时间**: 2周

**完成度**: 0%

**负责人**: _待分配_

#### 任务清单

| ID | 任务 | 预计时间 | 状态 | 完成度 | 负责人 | 开始日期 | 完成日期 | 备注 |
|----|------|----------|------|--------|--------|----------|----------|------|
| T4.1.1 | LDAP连接配置 | 1天 | 🔴 未开始 | 0% | - | - | - | - |
| T4.1.2 | LdapService实现 | 3天 | 🔴 未开始 | 0% | - | - | - | 依赖T4.1.1 |
| T4.1.3 | 用户同步服务 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T4.1.2 |
| T4.1.4 | 组同步服务 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T4.1.3 |
| T4.1.5 | 认证集成 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T4.1.4 |
| T4.1.6 | 单元测试和集成测试 | 2天 | 🔴 未开始 | 0% | - | - | - | 覆盖率≥75% |

### 4.2 流程迁移

**状态**: 🔴 未开始

**预计时间**: 1周

**完成度**: 0%

**负责人**: _待分配_

#### 任务清单

| ID | 任务 | 预计时间 | 状态 | 完成度 | 负责人 | 开始日期 | 完成日期 | 备注 |
|----|------|----------|------|--------|--------|----------|----------|------|
| T4.2.1 | 迁移策略设计 | 1天 | 🔴 未开始 | 0% | - | - | - | - |
| T4.2.2 | ProcessMigrationService实现 | 2天 | 🔴 未开始 | 0% | - | - | - | 依赖T4.2.1 |
| T4.2.3 | 迁移验证器 | 1天 | 🔴 未开始 | 0% | - | - | - | 依赖T4.2.2 |
| T4.2.4 | 迁移执行器 | 1天 | 🔴 未开始 | 0% | - | - | - | 依赖T4.2.3 |
| T4.2.5 | 单元测试 | 1天 | 🔴 未开始 | 0% | - | - | - | 覆盖率≥80% |

---

## v2.0 - 高级特性 (低优先级)

**目标**: 实现高级BPMN特性

**预计周期**: 6周

**版本状态**: 🔴 未开始

### 5.1 事务子流程

**状态**: 🔴 未开始

**预计时间**: 2周

**完成度**: 0%

### 5.2 动态流程修改

**状态**: 🔴 未开始

**预计时间**: 2周

**完成度**: 0%

### 5.3 CMMN案例管理 (可选)

**状态**: 🔴 未开始

**预计时间**: 2周

**完成度**: 0%

---

## 执行状态追踪

### 更新历史

| 日期 | 版本 | 更新内容 | 更新人 |
|------|------|----------|--------|
| 2024-XX-XX | v1.0 | 初始版本创建 | - |

### 状态统计

```
总任务数: 50
├── 🔴 未开始: 50 (100%)
├── 🟡 进行中: 0 (0%)
├── 🟢 已完成: 0 (0%)
├── 🔵 已阻塞: 0 (0%)
└── ⚪ 已取消: 0 (0%)
```

### 里程碑

| 里程碑 | 目标日期 | 状态 | 实际完成 | 备注 |
|--------|----------|------|----------|------|
| M1: v1.1完成 | - | 🔴 未开始 | - | DMN增强 |
| M2: v1.2完成 | - | 🔴 未开始 | - | 流程增强 |
| M3: v1.3完成 | - | 🔴 未开始 | - | 集成增强 |
| M4: v1.4完成 | - | 🔴 未开始 | - | 企业集成 |
| M5: v2.0完成 | - | 🔴 未开始 | - | 高级特性 |

---

## 资源需求

### 人员配置

| 角色 | 人数 | 状态 | 实际分配 |
|------|------|------|----------|
| 技术负责人 | 1 | ⬜ 未分配 | - |
| 高级开发 | 2 | ⬜ 未分配 | - |
| 中级开发 | 2 | ⬜ 未分配 | - |
| 测试工程师 | 1 | ⬜ 未分配 | - |

---

## 风险追踪

| 风险ID | 风险描述 | 影响程度 | 发生概率 | 状态 | 缓解措施 | 责任人 |
|--------|----------|----------|----------|------|----------|--------|
| R1 | FEEL表达式复杂度高 | 高 | 中 | ⚠️ 监控中 | 分阶段实现，优先常用语法 | - |
| R2 | 补偿事件实现复杂 | 高 | 中 | ⚠️ 监控中 | 参考Flowable实现 | - |
| R3 | LDAP兼容性问题 | 中 | 中 | ⚠️ 监控中 | 支持多种LDAP服务器 | - |
| R4 | 性能问题 | 高 | 低 | ⚠️ 监控中 | 性能测试，优化关键路径 | - |

---

## 附录

### 状态定义

| 状态 | 符号 | 说明 |
|------|------|------|
| 未开始 | 🔴 | 任务尚未开始 |
| 进行中 | 🟡 | 任务正在进行 |
| 已完成 | 🟢 | 任务已完成并通过验证 |
| 已阻塞 | 🔵 | 任务被阻塞，无法继续 |
| 已取消 | ⚪ | 任务已取消 |

### 如何更新状态

1. 更新任务状态时，同时更新以下字段：
   - `状态`: 更新为对应状态符号
   - `完成度`: 更新百分比
   - `开始日期`: 任务开始时填写
   - `完成日期`: 任务完成时填写

2. 更新版本状态时，同步更新：
   - 版本概览表中的状态和完成度
   - 执行状态追踪中的统计信息
   - 更新历史记录

3. 每周更新里程碑状态
